# Requirements Document

## Introduction

This document specifies requirements for eliminating the 34 false positives (85% error rate) currently generated by the compliance checker. The core issue is that the system uses brittle keyword matching and regex patterns instead of contextual understanding. An LLM naturally understands that "The fund invests in momentum strategies" is a fund description (ALLOWED), not investment advice (PROHIBITED). The enhanced system will leverage AI's contextual understanding to distinguish between similar phrases based on WHO is performing the action and WHAT the intent is.

## Glossary

- **Compliance_Checker**: The system that validates fund marketing documents against regulatory requirements
- **Context_Analyzer**: AI component that understands the semantic meaning and intent of text passages
- **Intent_Classifier**: Component that determines whether text is advice, description, or factual statement
- **False_Positive**: A violation flagged by the system that is not actually a violation
- **Fund_Strategy_Description**: Text describing what the fund does (ALLOWED in marketing materials)
- **Investment_Advice**: Text advising clients what they should do (PROHIBITED in marketing materials)
- **Semantic_Validator**: AI component that validates compliance based on meaning, not keywords
- **Evidence_Extractor**: Component that identifies and quotes specific text supporting violation findings

## Requirements

### Requirement 1: Distinguish Fund Strategy from Investment Advice

**User Story:** As a compliance officer, I want the system to understand that "The fund invests in momentum strategies" describes the fund's approach (ALLOWED), not advice to clients (PROHIBITED), so that I don't waste time reviewing 25 false positives about fund strategy descriptions.

#### Acceptance Criteria

1. WHEN text describes what the fund does, THE Context_Analyzer SHALL classify it as fund strategy description with 95% accuracy
2. WHEN text advises clients what they should do, THE Intent_Classifier SHALL flag it as investment advice with 95% accuracy
3. THE Semantic_Validator SHALL distinguish between "le fonds investit" (fund invests - ALLOWED) and "vous devriez investir" (you should invest - PROHIBITED)
4. WHEN analyzing phrases like "tirer parti du momentum", THE Context_Analyzer SHALL recognize this as a strategy goal, not client advice
5. WHERE text contains investment-related verbs, THE Intent_Classifier SHALL determine the subject (fund vs client) before flagging violations

### Requirement 2: Whitelist Fund Names and Strategy Terms

**User Story:** As a compliance analyst, I want the system to recognize that "ODDO BHF" is the fund name and "momentum" is a strategy term, so that these required terms are not flagged as repeated security mentions.

#### Acceptance Criteria

1. THE Compliance_Checker SHALL extract the fund name from document metadata and whitelist all its components
2. WHEN the fund name appears multiple times, THE Semantic_Validator SHALL NOT flag it as a repeated security mention
3. THE Context_Analyzer SHALL maintain a whitelist of strategy terminology (momentum, quantitative, systematic, algorithmic)
4. WHEN strategy terms appear in context of fund description, THE Semantic_Validator SHALL NOT flag them as securities
5. THE Compliance_Checker SHALL whitelist regulatory terms (SRI, SRRI, SFDR) that must appear in documents

### Requirement 3: Detect Actual Performance Data vs Performance Keywords

**User Story:** As a regulatory reviewer, I want the system to only flag violations when actual performance numbers are shown without disclaimers, not when the word "performance" appears in strategy descriptions, so that I don't review 3 false positives about performance disclaimers.

#### Acceptance Criteria

1. WHEN text contains performance numbers with percentages, THE Evidence_Extractor SHALL identify this as actual performance data
2. WHEN the word "performance" appears without numbers, THE Context_Analyzer SHALL classify it as descriptive text, not performance data
3. THE Semantic_Validator SHALL only require disclaimers when actual performance data is present on the same slide
4. WHEN analyzing "performance objective" or "attractive performance", THE Intent_Classifier SHALL recognize these as strategy descriptions
5. WHERE disclaimers are present, THE Evidence_Extractor SHALL verify they are on the same slide as performance data

### Requirement 4: Understand Document Structure Context

**User Story:** As a compliance manager, I want the system to correctly identify what content appears on the cover page versus internal slides, so that structural violations are accurately detected.

#### Acceptance Criteria

1. THE Context_Analyzer SHALL identify the cover page (page_de_garde) and distinguish it from internal content
2. WHEN checking if a document starts with performance, THE Semantic_Validator SHALL only examine the cover page content
3. THE Evidence_Extractor SHALL specify the exact slide location for all violations
4. WHEN disclaimers are required, THE Context_Analyzer SHALL verify they appear on the same slide as the content requiring them
5. THE Compliance_Checker SHALL understand document flow and cross-reference content across slides

### Requirement 5: Validate Prospectus Consistency with Semantic Understanding

**User Story:** As a fund administrator, I want the system to detect actual contradictions between marketing materials and the prospectus, not flag missing technical details that belong in the prospectus, so that I focus on real inconsistencies.

#### Acceptance Criteria

1. WHEN comparing marketing text to prospectus, THE Context_Analyzer SHALL identify contradictions, not missing details
2. THE Semantic_Validator SHALL recognize that "invests in S&P 500" is consistent with "at least 70% in S&P 500 equities"
3. WHERE marketing materials describe strategy at a high level, THE Intent_Classifier SHALL NOT flag missing technical thresholds
4. WHEN actual contradictions exist, THE Evidence_Extractor SHALL quote both the marketing text and prospectus text
5. THE Compliance_Checker SHALL provide confidence scores below 70% for borderline consistency issues requiring human review

### Requirement 6: Detect Missing Violations Through Context Analysis

**User Story:** As a quality assurance analyst, I want the system to catch violations that keyword matching misses, such as incomplete risk profiles and undefined anglicisms, so that compliance coverage is comprehensive.

#### Acceptance Criteria

1. THE Context_Analyzer SHALL compare risk lists across different slides to detect incomplete profiles
2. WHEN anglicisms appear in retail documents, THE Semantic_Validator SHALL verify they are defined in a glossary
3. THE Evidence_Extractor SHALL identify which risks are mentioned on one slide but missing from another
4. WHERE technical English terms are used, THE Intent_Classifier SHALL determine if the document is retail or professional
5. THE Compliance_Checker SHALL detect structural inconsistencies that require cross-slide analysis

### Requirement 7: Provide Explainable AI Decisions

**User Story:** As a compliance officer, I want to understand why the AI made each decision, so that I can trust the system and audit its reasoning.

#### Acceptance Criteria

1. THE Context_Analyzer SHALL provide human-readable explanations for all classification decisions
2. THE Evidence_Extractor SHALL quote specific text passages that support each violation finding
3. WHEN confidence is below 80%, THE Semantic_Validator SHALL explain what factors reduced confidence
4. THE Intent_Classifier SHALL describe the reasoning process (e.g., "Subject is 'le fonds', not 'vous', therefore fund description")
5. THE Compliance_Checker SHALL include AI reasoning in the violation output alongside traditional rule information

### Requirement 8: Maintain Performance with AI Integration

**User Story:** As a system administrator, I want AI analysis to complete within reasonable time limits, so that document processing remains practical for daily use.

#### Acceptance Criteria

1. THE Context_Analyzer SHALL process each compliance check in under 3 seconds on average
2. THE Semantic_Validator SHALL batch similar checks to optimize API usage
3. WHEN AI services are slow or unavailable, THE Compliance_Checker SHALL fall back to rule-based checking with clear warnings
4. THE Intent_Classifier SHALL cache similar analyses to avoid redundant AI calls
5. THE Compliance_Checker SHALL complete full document analysis in under 60 seconds

### Requirement 9: Achieve Target Accuracy Metrics

**User Story:** As a compliance manager, I want the enhanced system to match Kiro's accuracy (6 violations, 0 false positives), so that the system is production-ready.

#### Acceptance Criteria

1. THE Compliance_Checker SHALL reduce total violations from 40 to 6 on the test document (exemple.json)
2. THE Semantic_Validator SHALL eliminate all 25 false positives related to fund strategy descriptions
3. THE Context_Analyzer SHALL eliminate all 16 false positives related to repeated fund name mentions
4. THE Intent_Classifier SHALL eliminate all 3 false positives related to performance disclaimers
5. THE Compliance_Checker SHALL maintain detection of all 6 actual violations while eliminating false positives

### Requirement 10: Enable Gradual Migration and Testing

**User Story:** As a development team member, I want to test AI-enhanced checks alongside existing rule-based checks, so that we can validate improvements before full deployment.

#### Acceptance Criteria

1. THE Compliance_Checker SHALL support a comparison mode that runs both old and new logic
2. THE Semantic_Validator SHALL output side-by-side results showing violations from each approach
3. WHEN running in comparison mode, THE Context_Analyzer SHALL highlight differences between rule-based and AI-based findings
4. THE Compliance_Checker SHALL provide metrics on false positive reduction and accuracy improvement
5. WHERE configuration allows, THE Intent_Classifier SHALL operate in AI-only, rule-only, or hybrid mode
